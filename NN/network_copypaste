
class TCNN(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv3d_1 = nn.Conv3d(1, 48, (7, 7, 7), (1, 2, 2), padding = 0)
        self.relu_1 = nn.ReLU()
        self.batchnorm_1 = nn.BatchNorm3d(48, momentum=0.001)

        self.conv3d_2 = nn.Conv3d(48, 124, (5, 5, 5), (1, 1, 1), padding = 0)
        self.relu_2 = nn.ReLU()
        self.batchnorm_2 = nn.BatchNorm3d(124, momentum=0.001)

        self.conv3d_3 = nn.Conv3d(124, 256, (5, 5, 5), (1, 1, 1), padding = 0)
        self.relu_3 = nn.ReLU()
        self.batchnorm_3 = nn.BatchNorm3d(256, momentum=0.001)
        self.maxpool3d_3 = nn.MaxPool3d((1, 2, 2), (1, 2, 2))

        self.conv3d_4 = nn.Conv3d(256, 142, (5, 5, 5), (1, 1, 1), padding = 0)
        self.relu_4 = nn.ReLU()
        self.batchnorm_4 = nn.BatchNorm3d(142, momentum=0.001)

        self.conv1d_5 = nn.Conv1d(142, 4, kernel_size=1)

    def forward(self, x):

        x = self.conv3d_1(x)
        x = self.relu_1(x)
        x = self.batchnorm_1(x)

        x = self.conv3d_2(x)
        x = self.relu_2(x)
        x = self.batchnorm_2(x)

        x = self.conv3d_3(x)
        x = self.relu_3(x)
        x = self.batchnorm_3(x)
        x = self.maxpool3d_3(x)

        x = self.conv3d_4(x)
        x = self.relu_4(x)
        x = self.batchnorm_4(x)

        x = x.mean(dim=(-1, -2))
        x = self.conv1d_5(x)
        
        return x




class TCNN(nn.Module):
    def __init__(self):
        super().__init__()

        self.conv3d_1 = nn.Conv3d(1, 25, (5, 5, 5), (1, 1, 1), padding=0)
        self.relu_1 = nn.ReLU()

        self.conv3d_2 = nn.Conv3d(25, 44, (5, 5, 5), (1, 1, 1), padding=0)
        self.batchnorm_2 = nn.BatchNorm3d(44, momentum=0.1)
        self.relu_2 = nn.ReLU()

        self.conv3d_3 = nn.Conv3d(44, 64, (3, 5, 5), (1, 1, 1), padding=0)
        self.relu_3 = nn.ReLU()
        self.maxpool3d_3 = nn.MaxPool3d((1, 2, 2), (1, 2, 2))

        self.conv3d_4 = nn.Conv3d(64, 72, (3, 3, 3), (1, 1, 1), padding=0)
        self.batchnorm_4 = nn.BatchNorm3d(72, momentum=0.1)
        self.relu_4 = nn.ReLU()
        self.maxpool3d_4 = nn.MaxPool3d((1, 2, 2), (1, 2, 2))

        self.fc_5 = nn.Linear(72*31*15, 5120)
        self.relu_5 = nn.ReLU()
        self.dropout_5 = nn.Dropout1d(0.3)

        self.fc_6 = nn.Linear(5120, 720)
        self.relu_6 = nn.ReLU()
        self.dropout_6 = nn.Dropout1d(0.2)

        self.fc_7 = nn.Linear(720, 4)

    def forward(self, x):
        x = self.conv3d_1(x)
        x = self.relu_1(x)

        x = self.conv3d_2(x)
        x = self.batchnorm_2(x)
        x = self.relu_2(x)

        x = self.conv3d_3(x)
        x = self.relu_3(x)
        x = self.maxpool3d_3(x)

        x = self.conv3d_4(x)
        x = self.batchnorm_4(x)
        x = self.relu_4(x)
        x = self.maxpool3d_4(x)

        B, C, D, H, W = x.shape

        #print(C, H, W)

        # Flatten channels + spatial dimensions for each time step
        x = x.permute(0, 2, 1, 3, 4)  # [B, D, C, H, W]
        x = x.reshape(B, D, C*H*W)    # [B, D, C*H*W]
        
        # Apply FC to each time step
        x = self.fc_5(x)
        x = self.relu_4(x)
        x = self.dropout_5(x)

        x = self.fc_6(x)
        x = self.relu_6(x)
        x = self.dropout_6(x)

        x = self.fc_7(x)

        x = x.permute(0, 2, 1)

        return x


class TCNN(nn.Module):
    def __init__(self):
        super().__init__()

        self.conv3d_1 = nn.Conv3d(1, 4, (5, 5, 5), (1, 1, 1), padding=0)

        self.fc_6 = nn.Linear(4*138*72, 4)

    def forward(self, x):
        x = self.conv3d_1(x)

        B, C, D, H, W = x.shape

        #print(C, H, W)

        # Flatten channels + spatial dimensions for each time step
        x = x.permute(0, 2, 1, 3, 4)  # [B, D, C, H, W]
        x = x.reshape(B, D, C*H*W)    # [B, D, C*H*W]
        
        x = self.fc_6(x)

        x = x.permute(0, 2, 1)

        return x











class TCNN(nn.Module):
    def __init__(self):
        super().__init__()

        self.conv3d_1 = nn.Conv3d(1, 25, (5, 5, 5), (1, 1, 1), padding=0)
        self.batchnorm_1 = nn.BatchNorm3d(25, momentum=0.1)
        self.relu_1 = nn.ReLU()
        self.maxpool3d_1 = nn.MaxPool3d((1, 2, 2), (1, 2, 2))

        self.conv3d_2 = nn.Conv3d(25, 44, (5, 3, 3), (1, 1, 1), padding=0)
        self.batchnorm_2 = nn.BatchNorm3d(44, momentum=0.1)
        self.relu_2 = nn.ReLU()
        self.maxpool3d_2 = nn.MaxPool3d((1, 2, 2), (1, 2, 2))

        self.conv3d_3 = nn.Conv3d(44, 64, (5, 3, 3), (1, 1, 1), padding=0)
        self.batchnorm_3 = nn.BatchNorm3d(64, momentum=0.1)
        self.relu_3 = nn.ReLU()
        self.maxpool3d_3 = nn.MaxPool3d((1, 3, 3), (1, 2, 2))

        self.fc_4 = nn.Linear(64*15*7, 512)
        self.relu_4 = nn.ReLU()
        self.dropout_4 = nn.Dropout1d(0.3)

        self.fc_5 = nn.Linear(512, 4)

    def forward(self, x):
        x = self.conv3d_1(x)
        x = self.batchnorm_1(x)
        x = self.relu_1(x)
        x = self.maxpool3d_1(x)

        x = self.conv3d_2(x)
        x = self.batchnorm_2(x)
        x = self.relu_2(x)
        x = self.maxpool3d_2(x)

        x = self.conv3d_3(x)
        x = self.batchnorm_3(x)
        x = self.relu_3(x)
        x = self.maxpool3d_3(x)

        B, C, D, H, W = x.shape

        #print(C, H, W)

        x = x.permute(0, 2, 1, 3, 4)  # [B, D, C, H, W]
        x = x.reshape(B, D, C*H*W)    # [B, D, C*H*W]
        
        x = self.fc_4(x)
        x = self.relu_4(x)
        x = self.dropout_4(x)

        x = self.fc_5(x)

        x = x.permute(0, 2, 1)

        return x
    








class TCNN(nn.Module):
    def __init__(self):
        super().__init__()

        self.conv3d_1 = nn.Conv3d(1, 5, (5, 3, 3), (1, 1, 1), padding=0)
        self.bn1 = nn.BatchNorm3d(5)
        self.relu_1 = nn.ReLU()
        self.maxpool3d_1 = nn.MaxPool3d((1, 3, 3), (1, 2, 2))

        self.conv3d_2 = nn.Conv3d(5, 10, (5, 3, 3), (1, 1, 1), padding=0)
        self.bn2 = nn.BatchNorm3d(10)
        self.relu_2 = nn.ReLU()
        self.maxpool3d_2 = nn.MaxPool3d((1, 3, 3), (1, 2, 2))

        self.fc_4 = nn.Linear(10*33*16, 4)

    def forward(self, x):
        x = self.conv3d_1(x)
        x = self.relu_1(x)
        x = self.maxpool3d_1(x)

        x = self.conv3d_2(x)
        x = self.relu_2(x)
        x = self.maxpool3d_2(x)

        B, C, D, H, W = x.shape

        #print(C, H, W)

        x = x.permute(0, 2, 1, 3, 4)  # [B, D, C, H, W]
        x = x.reshape(B, D, C*H*W)    # [B, D, C*H*W]
        
        x = self.fc_4(x)

        x = x.permute(0, 2, 1)

        return x









    